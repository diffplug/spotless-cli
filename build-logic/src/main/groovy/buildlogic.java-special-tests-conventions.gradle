plugins {
	id 'java'
	id 'com.adarshr.test-logger'
}

// See com.diffplug.spotless.tag package for available JUnit 5 @Tag annotations
def special = [
	'npm',
	'cliProcess',
	'cliProcessNpm',
	'cliNative',
	'cliNativeNpm'
]

tasks.named('test').configure {
	useJUnitPlatform {
		excludeTags special as String[]
	}
}

special.forEach { tag ->
	tasks.register("test${tag.capitalize()}", Test) {
		useJUnitPlatform { includeTags tag }
	}
}

tasks.register('testAll') {
	dependsOn tasks.matching { it.name.startsWith('test') && it.name != 'testAll' }
}

def testAllCliProcess = tasks.register('testAllCliProcess') {
	dependsOn tasks.matching { it.name.startsWith('testCliProcess') }
}

tasks.named('check').configure {
	it.dependsOn(testAllCliProcess)
}

tasks.register('testAllCliNative') {
	dependsOn tasks.matching { it.name.startsWith('testCliNative') }
}

tasks.withType(Test).configureEach {
	testLogging.showStandardStreams = true
}
